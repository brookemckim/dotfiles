#!/bin/sh

server=$1
rubies=$2

ruby_www="http://ftp.ruby-lang.org/pub/ruby"

if [ -z $2 ]; then
  rubies='1.9.3-p0'
  echo "Installing $rubies"
else
  rubies=$2
  echo "Installing $2"
fi  

if [[ "$rubies" == 1.9* ]]; then
  ver="1.9"
elif [[ "$rubies" == 1.8* ]]; then
  ver="1.8"
else
  echo "Unrecognized Ruby version"
  exit 1
fi      

# Bootstrap the server for Ruby install && Install Ruby
#
# Other Dependencies: 
#  Nokogiri
#    libxml2-dev
#    libxslt-dev
#  Psych
#    libyaml-dev
#  Sqlite
#    sqlite3
#    sqlite3-dev
ssh $server "apt-get update -y \
             && apt-get install -y build-essential git-core subversion vim \
                zlib1g-dev libssl-dev libruby1.8 libxslt-dev libxml2-dev sqlite3 libsqlite3-dev \
                libreadline5-dev libncurses5-dev libreadline5 libyaml-dev \
             && wget $ruby_www/$ver/ruby-$rubies.tar.gz -O - | tar xzv \
             && cd ruby-$rubies &&  ./configure && make && make install \
             && gem update --system \
             && gem install bundler --no-ri --no-rdoc"
